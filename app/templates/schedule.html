<!DOCTYPE html>
{% extends "base.html" %}

{% block head_extra %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/schedule.css') }}">
{% endblock %}

{% block content %}
<div class="schedule-container">
    <!-- Google Calendar Connection Card -->
    <div class="calendar-integration-card">
        <div class="integration-header">
            <div class="integration-icon">
                <i class="fab fa-google"></i>
            </div>
            <div class="integration-info">
                <h3>Google Calendar</h3>
                <p>Sync your tasks with Google Calendar for seamless planning</p>
            </div>
        </div>
        <div class="integration-status">
            {% if calendar_connected %}
                <div class="status-indicator connected">
                    <i class="fas fa-check-circle"></i>
                    <span>Connected</span>
                </div>
                <a href="{{ url_for('main.disconnect_google') }}" class="btn btn-disconnect">
                    <i class="fas fa-unlink"></i>
                    Disconnect
                </a>
            {% else %}
                <div class="status-indicator disconnected">
                    <i class="fas fa-exclamation-circle"></i>
                    <span>Not Connected</span>
                </div>
                <a href="{{ url_for('main.authorize_google') }}" class="btn btn-connect">
                    <i class="fas fa-link"></i>
                    Connect Now
                </a>
            {% endif %}
        </div>
    </div>

    <!-- Tasks Grid Section -->
    <div class="tasks-section">
        <div class="section-header">
            <h2><i class="fas fa-tasks"></i> Your Tasks</h2>
            <a href="{{ url_for('main.add_task') }}" class="btn btn-add-task">
                <i class="fas fa-plus"></i> Add Task
            </a>
        </div>
        
        {% if tasks %}
            <div class="tasks-grid">
                {% for task in tasks %}
                <div class="task-card {{ 'synced' if task.synced_to_calendar else '' }}">
                    <div class="task-card-header">
                        <div class="task-title-section">
                            <h4>{{ task.title }}</h4>
                            <span class="task-status status-{{ task.status }}">
                                <i class="fas fa-{{ 'check-circle' if task.status == 'done' else 'clock' if task.status == 'doing' else 'circle' }}"></i>
                                {{ task.status.title() }}
                            </span>
                        </div>
                        {% if task.synced_to_calendar %}
                            <div class="sync-badge">
                                <i class="fas fa-sync-alt"></i>
                            </div>
                        {% endif %}
                    </div>
                    
                    <div class="task-card-body">
                        <div class="task-info">
                            <div class="info-item">
                                <i class="fas fa-calendar"></i>
                                <span class="info-label">Due Date:</span>
                                {% if task.due_date %}
                                    <span class="info-value">{{ task.due_date.strftime('%b %d, %Y at %I:%M %p') }}</span>
                                {% else %}
                                    <span class="info-value muted">No due date</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <div class="task-card-footer">
                        {% if calendar_connected %}
                            {% if not task.synced_to_calendar %}
                                <button class="btn-action btn-sync sync-task" data-task-id="{{ task.id }}">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                    <span>Sync to Calendar</span>
                                </button>
                            {% else %}
                                <button class="btn-action btn-update sync-task" data-task-id="{{ task.id }}">
                                    <i class="fas fa-sync"></i>
                                    <span>Update</span>
                                </button>
                                <button class="btn-action btn-remove remove-task" data-task-id="{{ task.id }}">
                                    <i class="fas fa-trash-alt"></i>
                                    <span>Remove</span>
                                </button>
                            {% endif %}
                        {% else %}
                            <div class="calendar-required">
                                <i class="fas fa-info-circle"></i>
                                <span>Connect Google Calendar to sync</span>
                            </div>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="empty-state">
                <div class="empty-icon">
                    <i class="fas fa-clipboard-list"></i>
                </div>
                <h3>No tasks yet</h3>
                <p>Create your first task to get started with scheduling</p>
                <a href="{{ url_for('main.add_task') }}" class="btn btn-primary-large">
                    <i class="fas fa-plus-circle"></i>
                    Create Your First Task
                </a>
            </div>
        {% endif %}
    </div>

    <!-- Google Calendar Events Section -->
    {% if calendar_connected %}
    <div class="calendar-events-section">
        <div class="section-header">
            <h2><i class="fab fa-google"></i> Upcoming Google Calendar Events</h2>
            <span class="event-count">{{ calendar_events|length if calendar_events else 0 }} events</span>
        </div>
        
        {% if calendar_events %}
            <div class="events-timeline">
                {% for event in calendar_events %}
                <div class="event-card">
                    <div class="event-indicator"></div>
                    <div class="event-content">
                        <div class="event-header">
                            <h4>{{ event.get('summary', 'No title') }}</h4>
                            <div class="event-time">
                                <i class="fas fa-clock"></i>
                                {% if event.get('start', {}).get('dateTime') %}
                                    {{ event['start']['dateTime'][:16].replace('T', ' ') }}
                                {% elif event.get('start', {}).get('date') %}
                                    <span class="all-day">{{ event['start']['date'] }}</span>
                                    <span class="all-day-badge">All Day</span>
                                {% endif %}
                            </div>
                        </div>
                        {% if event.get('description') %}
                        <p class="event-description">{{ event['description'] }}</p>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="empty-events">
                <div class="empty-icon">
                    <i class="far fa-calendar-times"></i>
                </div>
                <h3>No upcoming events</h3>
                <p>Your Google Calendar is clear. Enjoy your free time!</p>
            </div>
        {% endif %}
    </div>
    {% endif %}
</div>

{% endblock %}

{% block body_extra %}
<script src="{{ url_for('static', filename='js/schedule.js') }}"></script>
{% endblock %}